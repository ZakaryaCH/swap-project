{"ast":null,"code":"var _jsxFileName = \"/Users/chichke/Documents/Work/Freelance/swap-project/src/components/earn/StakingModal.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useCallback } from 'react';\nimport useIsArgentWallet from '../../hooks/useIsArgentWallet';\nimport useTransactionDeadline from '../../hooks/useTransactionDeadline';\nimport Modal from '../Modal';\nimport { AutoColumn } from '../Column';\nimport styled from 'styled-components';\nimport { RowBetween } from '../Row';\nimport { TYPE, CloseIcon } from '../../theme';\nimport { ButtonConfirmed, ButtonError } from '../Button';\nimport ProgressCircles from '../ProgressSteps';\nimport CurrencyInputPanel from '../CurrencyInputPanel';\nimport { TokenAmount, Pair } from '@uniswap/sdk';\nimport { useActiveWeb3React } from '../../hooks';\nimport { maxAmountSpend } from '../../utils/maxAmountSpend';\nimport { usePairContract, useStakingContract } from '../../hooks/useContract';\nimport { useApproveCallback, ApprovalState } from '../../hooks/useApproveCallback';\nimport { splitSignature } from 'ethers/lib/utils';\nimport { useDerivedStakeInfo } from '../../state/stake/hooks';\nimport { wrappedCurrencyAmount } from '../../utils/wrappedCurrency';\nimport { useTransactionAdder } from '../../state/transactions/hooks';\nimport { LoadingView, SubmittedView } from '../ModalViews';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst HypotheticalRewardRate = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding-right: 20px;\n  padding-left: 20px;\n\n  opacity: ${({\n  dim\n}) => dim ? 0.5 : 1};\n`;\n_c = HypotheticalRewardRate;\nconst ContentWrapper = styled(AutoColumn)`\n  width: 100%;\n  padding: 1rem;\n`;\n_c2 = ContentWrapper;\nexport default function StakingModal({\n  isOpen,\n  onDismiss,\n  stakingInfo,\n  userLiquidityUnstaked\n}) {\n  _s();\n\n  const {\n    account,\n    chainId,\n    library\n  } = useActiveWeb3React(); // track and parse user input\n\n  const [typedValue, setTypedValue] = useState('');\n  const {\n    parsedAmount,\n    error\n  } = useDerivedStakeInfo(typedValue, stakingInfo.stakedAmount.token, userLiquidityUnstaked);\n  const parsedAmountWrapped = wrappedCurrencyAmount(parsedAmount, chainId);\n  let hypotheticalRewardRate = new TokenAmount(stakingInfo.rewardRate.token, '0');\n\n  if (parsedAmountWrapped === null || parsedAmountWrapped === void 0 ? void 0 : parsedAmountWrapped.greaterThan('0')) {\n    hypotheticalRewardRate = stakingInfo.getHypotheticalRewardRate(stakingInfo.stakedAmount.add(parsedAmountWrapped), stakingInfo.totalStakedAmount.add(parsedAmountWrapped), stakingInfo.totalRewardRate);\n  } // state for pending and submitted txn views\n\n\n  const addTransaction = useTransactionAdder();\n  const [attempting, setAttempting] = useState(false);\n  const [hash, setHash] = useState();\n  const wrappedOnDismiss = useCallback(() => {\n    setHash(undefined);\n    setAttempting(false);\n    onDismiss();\n  }, [onDismiss]); // pair contract for this token to be staked\n\n  const dummyPair = new Pair(new TokenAmount(stakingInfo.tokens[0], '0'), new TokenAmount(stakingInfo.tokens[1], '0'));\n  const pairContract = usePairContract(dummyPair.liquidityToken.address); // approval data for stake\n\n  const deadline = useTransactionDeadline();\n  const [signatureData, setSignatureData] = useState(null);\n  const [approval, approveCallback] = useApproveCallback(parsedAmount, stakingInfo.stakingRewardAddress);\n  const isArgentWallet = useIsArgentWallet();\n  const stakingContract = useStakingContract(stakingInfo.stakingRewardAddress);\n\n  async function onStake() {\n    setAttempting(true);\n\n    if (stakingContract && parsedAmount && deadline) {\n      if (approval === ApprovalState.APPROVED) {\n        await stakingContract.stake(`0x${parsedAmount.raw.toString(16)}`, {\n          gasLimit: 350000\n        });\n      } else if (signatureData) {\n        stakingContract.stakeWithPermit(`0x${parsedAmount.raw.toString(16)}`, signatureData.deadline, signatureData.v, signatureData.r, signatureData.s, {\n          gasLimit: 350000\n        }).then(response => {\n          addTransaction(response, {\n            summary: `Deposit liquidity`\n          });\n          setHash(response.hash);\n        }).catch(error => {\n          setAttempting(false);\n          console.log(error);\n        });\n      } else {\n        setAttempting(false);\n        throw new Error('Attempting to stake without approval or a signature. Please contact support.');\n      }\n    }\n  } // wrapped onUserInput to clear signatures\n\n\n  const onUserInput = useCallback(typedValue => {\n    setSignatureData(null);\n    setTypedValue(typedValue);\n  }, []); // used for max input button\n\n  const maxAmountInput = maxAmountSpend(userLiquidityUnstaked);\n  const atMaxAmount = Boolean(maxAmountInput && (parsedAmount === null || parsedAmount === void 0 ? void 0 : parsedAmount.equalTo(maxAmountInput)));\n  const handleMax = useCallback(() => {\n    maxAmountInput && onUserInput(maxAmountInput.toExact());\n  }, [maxAmountInput, onUserInput]);\n\n  async function onAttemptToApprove() {\n    if (!pairContract || !library || !deadline) throw new Error('missing dependencies');\n    const liquidityAmount = parsedAmount;\n    if (!liquidityAmount) throw new Error('missing liquidity amount');\n\n    if (isArgentWallet) {\n      return approveCallback();\n    } // try to gather a signature for permission\n\n\n    const nonce = await pairContract.nonces(account);\n    const EIP712Domain = [{\n      name: 'name',\n      type: 'string'\n    }, {\n      name: 'version',\n      type: 'string'\n    }, {\n      name: 'chainId',\n      type: 'uint256'\n    }, {\n      name: 'verifyingContract',\n      type: 'address'\n    }];\n    const domain = {\n      name: 'Uniswap V2',\n      version: '1',\n      chainId: chainId,\n      verifyingContract: pairContract.address\n    };\n    const Permit = [{\n      name: 'owner',\n      type: 'address'\n    }, {\n      name: 'spender',\n      type: 'address'\n    }, {\n      name: 'value',\n      type: 'uint256'\n    }, {\n      name: 'nonce',\n      type: 'uint256'\n    }, {\n      name: 'deadline',\n      type: 'uint256'\n    }];\n    const message = {\n      owner: account,\n      spender: stakingInfo.stakingRewardAddress,\n      value: liquidityAmount.raw.toString(),\n      nonce: nonce.toHexString(),\n      deadline: deadline.toNumber()\n    };\n    const data = JSON.stringify({\n      types: {\n        EIP712Domain,\n        Permit\n      },\n      domain,\n      primaryType: 'Permit',\n      message\n    });\n    library.send('eth_signTypedData_v4', [account, data]).then(splitSignature).then(signature => {\n      setSignatureData({\n        v: signature.v,\n        r: signature.r,\n        s: signature.s,\n        deadline: deadline.toNumber()\n      });\n    }).catch(error => {\n      // for all errors other than 4001 (EIP-1193 user rejected request), fall back to manual approve\n      if ((error === null || error === void 0 ? void 0 : error.code) !== 4001) {\n        approveCallback();\n      }\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(Modal, {\n    isOpen: isOpen,\n    onDismiss: wrappedOnDismiss,\n    maxHeight: 90,\n    children: [!attempting && !hash && /*#__PURE__*/_jsxDEV(ContentWrapper, {\n      gap: \"lg\",\n      children: [/*#__PURE__*/_jsxDEV(RowBetween, {\n        children: [/*#__PURE__*/_jsxDEV(TYPE.mediumHeader, {\n          children: \"Deposit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(CloseIcon, {\n          onClick: wrappedOnDismiss\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(CurrencyInputPanel, {\n        value: typedValue,\n        onUserInput: onUserInput,\n        onMax: handleMax,\n        showMaxButton: !atMaxAmount,\n        currency: stakingInfo.stakedAmount.token,\n        pair: dummyPair,\n        label: '',\n        disableCurrencySelect: true,\n        customBalanceText: 'Available to deposit: ',\n        id: \"stake-liquidity-token\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(HypotheticalRewardRate, {\n        dim: !hypotheticalRewardRate.greaterThan('0'),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(TYPE.black, {\n            fontWeight: 600,\n            children: \"Weekly Rewards\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(TYPE.black, {\n          children: [hypotheticalRewardRate.multiply((60 * 60 * 24 * 7).toString()).toSignificant(4, {\n            groupSeparator: ','\n          }), ' ', \"POGO / week\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(RowBetween, {\n        children: [/*#__PURE__*/_jsxDEV(ButtonConfirmed, {\n          mr: \"0.5rem\",\n          onClick: onAttemptToApprove,\n          confirmed: approval === ApprovalState.APPROVED || signatureData !== null,\n          disabled: approval !== ApprovalState.NOT_APPROVED || signatureData !== null,\n          children: \"Approve\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ButtonError, {\n          disabled: !!error || signatureData === null && approval !== ApprovalState.APPROVED,\n          error: !!error && !!parsedAmount,\n          onClick: onStake,\n          children: error !== null && error !== void 0 ? error : 'Deposit'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(ProgressCircles, {\n        steps: [approval === ApprovalState.APPROVED || signatureData !== null],\n        disabled: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }, this), attempting && !hash && /*#__PURE__*/_jsxDEV(LoadingView, {\n      onDismiss: wrappedOnDismiss,\n      children: /*#__PURE__*/_jsxDEV(AutoColumn, {\n        gap: \"12px\",\n        justify: 'center',\n        children: [/*#__PURE__*/_jsxDEV(TYPE.largeHeader, {\n          children: \"Depositing Liquidity\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(TYPE.body, {\n          fontSize: 20,\n          children: [parsedAmount === null || parsedAmount === void 0 ? void 0 : parsedAmount.toSignificant(4), \" UNI-V2\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }, this), attempting && hash && /*#__PURE__*/_jsxDEV(SubmittedView, {\n      onDismiss: wrappedOnDismiss,\n      hash: hash,\n      children: /*#__PURE__*/_jsxDEV(AutoColumn, {\n        gap: \"12px\",\n        justify: 'center',\n        children: [/*#__PURE__*/_jsxDEV(TYPE.largeHeader, {\n          children: \"Transaction Submitted\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(TYPE.body, {\n          fontSize: 20,\n          children: [\"Deposited \", parsedAmount === null || parsedAmount === void 0 ? void 0 : parsedAmount.toSignificant(4), \" UNI-V2\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 196,\n    columnNumber: 5\n  }, this);\n}\n\n_s(StakingModal, \"3Pkgolw3olI6AOmzFLvnS2UcsTI=\", false, function () {\n  return [useActiveWeb3React, useDerivedStakeInfo, useTransactionAdder, usePairContract, useTransactionDeadline, useApproveCallback, useIsArgentWallet, useStakingContract];\n});\n\n_c3 = StakingModal;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"HypotheticalRewardRate\");\n$RefreshReg$(_c2, \"ContentWrapper\");\n$RefreshReg$(_c3, \"StakingModal\");","map":{"version":3,"sources":["/Users/chichke/Documents/Work/Freelance/swap-project/src/components/earn/StakingModal.tsx"],"names":["React","useState","useCallback","useIsArgentWallet","useTransactionDeadline","Modal","AutoColumn","styled","RowBetween","TYPE","CloseIcon","ButtonConfirmed","ButtonError","ProgressCircles","CurrencyInputPanel","TokenAmount","Pair","useActiveWeb3React","maxAmountSpend","usePairContract","useStakingContract","useApproveCallback","ApprovalState","splitSignature","useDerivedStakeInfo","wrappedCurrencyAmount","useTransactionAdder","LoadingView","SubmittedView","HypotheticalRewardRate","div","dim","ContentWrapper","StakingModal","isOpen","onDismiss","stakingInfo","userLiquidityUnstaked","account","chainId","library","typedValue","setTypedValue","parsedAmount","error","stakedAmount","token","parsedAmountWrapped","hypotheticalRewardRate","rewardRate","greaterThan","getHypotheticalRewardRate","add","totalStakedAmount","totalRewardRate","addTransaction","attempting","setAttempting","hash","setHash","wrappedOnDismiss","undefined","dummyPair","tokens","pairContract","liquidityToken","address","deadline","signatureData","setSignatureData","approval","approveCallback","stakingRewardAddress","isArgentWallet","stakingContract","onStake","APPROVED","stake","raw","toString","gasLimit","stakeWithPermit","v","r","s","then","response","summary","catch","console","log","Error","onUserInput","maxAmountInput","atMaxAmount","Boolean","equalTo","handleMax","toExact","onAttemptToApprove","liquidityAmount","nonce","nonces","EIP712Domain","name","type","domain","version","verifyingContract","Permit","message","owner","spender","value","toHexString","toNumber","data","JSON","stringify","types","primaryType","send","signature","code","multiply","toSignificant","groupSeparator","NOT_APPROVED"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport useIsArgentWallet from '../../hooks/useIsArgentWallet'\nimport useTransactionDeadline from '../../hooks/useTransactionDeadline'\nimport Modal from '../Modal'\nimport { AutoColumn } from '../Column'\nimport styled from 'styled-components'\nimport { RowBetween } from '../Row'\nimport { TYPE, CloseIcon } from '../../theme'\nimport { ButtonConfirmed, ButtonError } from '../Button'\nimport ProgressCircles from '../ProgressSteps'\nimport CurrencyInputPanel from '../CurrencyInputPanel'\nimport { TokenAmount, Pair } from '@uniswap/sdk'\nimport { useActiveWeb3React } from '../../hooks'\nimport { maxAmountSpend } from '../../utils/maxAmountSpend'\nimport { usePairContract, useStakingContract } from '../../hooks/useContract'\nimport { useApproveCallback, ApprovalState } from '../../hooks/useApproveCallback'\nimport { splitSignature } from 'ethers/lib/utils'\nimport { StakingInfo, useDerivedStakeInfo } from '../../state/stake/hooks'\nimport { wrappedCurrencyAmount } from '../../utils/wrappedCurrency'\nimport { TransactionResponse } from '@ethersproject/providers'\nimport { useTransactionAdder } from '../../state/transactions/hooks'\nimport { LoadingView, SubmittedView } from '../ModalViews'\n\nconst HypotheticalRewardRate = styled.div<{ dim: boolean }>`\n  display: flex;\n  justify-content: space-between;\n  padding-right: 20px;\n  padding-left: 20px;\n\n  opacity: ${({ dim }) => (dim ? 0.5 : 1)};\n`\n\nconst ContentWrapper = styled(AutoColumn)`\n  width: 100%;\n  padding: 1rem;\n`\n\ninterface StakingModalProps {\n  isOpen: boolean\n  onDismiss: () => void\n  stakingInfo: StakingInfo\n  userLiquidityUnstaked: TokenAmount | undefined\n}\n\nexport default function StakingModal({ isOpen, onDismiss, stakingInfo, userLiquidityUnstaked }: StakingModalProps) {\n  const { account, chainId, library } = useActiveWeb3React()\n\n  // track and parse user input\n  const [typedValue, setTypedValue] = useState('')\n  const { parsedAmount, error } = useDerivedStakeInfo(typedValue, stakingInfo.stakedAmount.token, userLiquidityUnstaked)\n  const parsedAmountWrapped = wrappedCurrencyAmount(parsedAmount, chainId)\n\n  let hypotheticalRewardRate: TokenAmount = new TokenAmount(stakingInfo.rewardRate.token, '0')\n  if (parsedAmountWrapped?.greaterThan('0')) {\n    hypotheticalRewardRate = stakingInfo.getHypotheticalRewardRate(\n      stakingInfo.stakedAmount.add(parsedAmountWrapped),\n      stakingInfo.totalStakedAmount.add(parsedAmountWrapped),\n      stakingInfo.totalRewardRate\n    )\n  }\n\n  // state for pending and submitted txn views\n  const addTransaction = useTransactionAdder()\n  const [attempting, setAttempting] = useState<boolean>(false)\n  const [hash, setHash] = useState<string | undefined>()\n  const wrappedOnDismiss = useCallback(() => {\n    setHash(undefined)\n    setAttempting(false)\n    onDismiss()\n  }, [onDismiss])\n\n  // pair contract for this token to be staked\n  const dummyPair = new Pair(new TokenAmount(stakingInfo.tokens[0], '0'), new TokenAmount(stakingInfo.tokens[1], '0'))\n  const pairContract = usePairContract(dummyPair.liquidityToken.address)\n\n  // approval data for stake\n  const deadline = useTransactionDeadline()\n  const [signatureData, setSignatureData] = useState<{ v: number; r: string; s: string; deadline: number } | null>(null)\n  const [approval, approveCallback] = useApproveCallback(parsedAmount, stakingInfo.stakingRewardAddress)\n\n  const isArgentWallet = useIsArgentWallet()\n  const stakingContract = useStakingContract(stakingInfo.stakingRewardAddress)\n  async function onStake() {\n    setAttempting(true)\n    if (stakingContract && parsedAmount && deadline) {\n      if (approval === ApprovalState.APPROVED) {\n        await stakingContract.stake(`0x${parsedAmount.raw.toString(16)}`, { gasLimit: 350000 })\n      } else if (signatureData) {\n        stakingContract\n          .stakeWithPermit(\n            `0x${parsedAmount.raw.toString(16)}`,\n            signatureData.deadline,\n            signatureData.v,\n            signatureData.r,\n            signatureData.s,\n            { gasLimit: 350000 }\n          )\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: `Deposit liquidity`\n            })\n            setHash(response.hash)\n          })\n          .catch((error: any) => {\n            setAttempting(false)\n            console.log(error)\n          })\n      } else {\n        setAttempting(false)\n        throw new Error('Attempting to stake without approval or a signature. Please contact support.')\n      }\n    }\n  }\n\n  // wrapped onUserInput to clear signatures\n  const onUserInput = useCallback((typedValue: string) => {\n    setSignatureData(null)\n    setTypedValue(typedValue)\n  }, [])\n\n  // used for max input button\n  const maxAmountInput = maxAmountSpend(userLiquidityUnstaked)\n  const atMaxAmount = Boolean(maxAmountInput && parsedAmount?.equalTo(maxAmountInput))\n  const handleMax = useCallback(() => {\n    maxAmountInput && onUserInput(maxAmountInput.toExact())\n  }, [maxAmountInput, onUserInput])\n\n  async function onAttemptToApprove() {\n    if (!pairContract || !library || !deadline) throw new Error('missing dependencies')\n    const liquidityAmount = parsedAmount\n    if (!liquidityAmount) throw new Error('missing liquidity amount')\n\n    if (isArgentWallet) {\n      return approveCallback()\n    }\n\n    // try to gather a signature for permission\n    const nonce = await pairContract.nonces(account)\n\n    const EIP712Domain = [\n      { name: 'name', type: 'string' },\n      { name: 'version', type: 'string' },\n      { name: 'chainId', type: 'uint256' },\n      { name: 'verifyingContract', type: 'address' }\n    ]\n    const domain = {\n      name: 'Uniswap V2',\n      version: '1',\n      chainId: chainId,\n      verifyingContract: pairContract.address\n    }\n    const Permit = [\n      { name: 'owner', type: 'address' },\n      { name: 'spender', type: 'address' },\n      { name: 'value', type: 'uint256' },\n      { name: 'nonce', type: 'uint256' },\n      { name: 'deadline', type: 'uint256' }\n    ]\n    const message = {\n      owner: account,\n      spender: stakingInfo.stakingRewardAddress,\n      value: liquidityAmount.raw.toString(),\n      nonce: nonce.toHexString(),\n      deadline: deadline.toNumber()\n    }\n    const data = JSON.stringify({\n      types: {\n        EIP712Domain,\n        Permit\n      },\n      domain,\n      primaryType: 'Permit',\n      message\n    })\n\n    library\n      .send('eth_signTypedData_v4', [account, data])\n      .then(splitSignature)\n      .then(signature => {\n        setSignatureData({\n          v: signature.v,\n          r: signature.r,\n          s: signature.s,\n          deadline: deadline.toNumber()\n        })\n      })\n      .catch(error => {\n        // for all errors other than 4001 (EIP-1193 user rejected request), fall back to manual approve\n        if (error?.code !== 4001) {\n          approveCallback()\n        }\n      })\n  }\n\n  return (\n    <Modal isOpen={isOpen} onDismiss={wrappedOnDismiss} maxHeight={90}>\n      {!attempting && !hash && (\n        <ContentWrapper gap=\"lg\">\n          <RowBetween>\n            <TYPE.mediumHeader>Deposit</TYPE.mediumHeader>\n            <CloseIcon onClick={wrappedOnDismiss} />\n          </RowBetween>\n          <CurrencyInputPanel\n            value={typedValue}\n            onUserInput={onUserInput}\n            onMax={handleMax}\n            showMaxButton={!atMaxAmount}\n            currency={stakingInfo.stakedAmount.token}\n            pair={dummyPair}\n            label={''}\n            disableCurrencySelect={true}\n            customBalanceText={'Available to deposit: '}\n            id=\"stake-liquidity-token\"\n          />\n\n          <HypotheticalRewardRate dim={!hypotheticalRewardRate.greaterThan('0')}>\n            <div>\n              <TYPE.black fontWeight={600}>Weekly Rewards</TYPE.black>\n            </div>\n\n            <TYPE.black>\n              {hypotheticalRewardRate.multiply((60 * 60 * 24 * 7).toString()).toSignificant(4, { groupSeparator: ',' })}{' '}\n              POGO / week\n            </TYPE.black>\n          </HypotheticalRewardRate>\n\n          <RowBetween>\n            <ButtonConfirmed\n              mr=\"0.5rem\"\n              onClick={onAttemptToApprove}\n              confirmed={approval === ApprovalState.APPROVED || signatureData !== null}\n              disabled={approval !== ApprovalState.NOT_APPROVED || signatureData !== null}\n            >\n              Approve\n            </ButtonConfirmed>\n            <ButtonError\n              disabled={!!error || (signatureData === null && approval !== ApprovalState.APPROVED)}\n              error={!!error && !!parsedAmount}\n              onClick={onStake}\n            >\n              {error ?? 'Deposit'}\n            </ButtonError>\n          </RowBetween>\n          <ProgressCircles steps={[approval === ApprovalState.APPROVED || signatureData !== null]} disabled={true} />\n        </ContentWrapper>\n      )}\n      {attempting && !hash && (\n        <LoadingView onDismiss={wrappedOnDismiss}>\n          <AutoColumn gap=\"12px\" justify={'center'}>\n            <TYPE.largeHeader>Depositing Liquidity</TYPE.largeHeader>\n            <TYPE.body fontSize={20}>{parsedAmount?.toSignificant(4)} UNI-V2</TYPE.body>\n          </AutoColumn>\n        </LoadingView>\n      )}\n      {attempting && hash && (\n        <SubmittedView onDismiss={wrappedOnDismiss} hash={hash}>\n          <AutoColumn gap=\"12px\" justify={'center'}>\n            <TYPE.largeHeader>Transaction Submitted</TYPE.largeHeader>\n            <TYPE.body fontSize={20}>Deposited {parsedAmount?.toSignificant(4)} UNI-V2</TYPE.body>\n          </AutoColumn>\n        </SubmittedView>\n      )}\n    </Modal>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}